<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PaymentSDK: Signature</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="wirecard-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PaymentSDK
   </div>
   <div id="projectbrief">Mobile payment SDK</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('p_2_2_signature.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Signature </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_authentication"></a>
Authentication by Signature</h1>
<p>As payment information is exchanged between the merchant's system, the consumer's application, and Wirecard´s Payment Processing Gateway, it is important that the data exchange safeguards against man-in-the-middle attacks.</p>
<p>Mobile payment endpoint uses a digital SHA-256 signature for all message exchanges. This digital signature is a mathematical scheme for demonstrating the authenticity of a digital message or document. A valid digital signature let a recipient believe that the message was created by a known sender, and that it was not altered, while transmitting.</p>
<h1><a class="anchor" id="sec_secret_key"></a>
Secret Key Exchange</h1>
<p>To ensure the authenticity of the request and response messages, it is required that a Secret Key is shared with the merchant.</p>
<p>The Secret Key is used in generation of the request_signature fields.</p>
<p>It is important that the Secret Key is never shared with anyone and is protected within the merchant server (only used in server side code for generating the request signature or validating the response signature). Never store your secret key inside your application nor on the phone.</p>
<p>The Secret Key will be communicated at the time of Merchant Account setup. Please contact your support representative if you did not receive a Secret Key or require Secret Key regeneration.</p>
<h1><a class="anchor" id="sec_request_signature"></a>
Request Signature</h1>
<p>Merchant needs to create a digital signature on his own server as it is the only place where the Secret is stored. The clientâs server also provides the Merchant Account ID to the mobile app client. To calculate the signature, following conditions need to be met:</p>
<ul>
<li>Fields need to be concatenated,</li>
<li>leading and trailing space removed,</li>
<li>SHA-256 signature follows the combined string.</li>
</ul>
<p>Please note that the order of the fields is important. Also note, the same values used in the request signature must be placed into the client side form/data (with the exception of the secret key).</p>
<ol type="1">
<li><code>request_time_stamp</code></li>
<li><code>request_id</code></li>
<li><code>merchant_account_id</code></li>
<li><code>transaction_type</code></li>
<li><code>requested_amount</code> (must be with a dot decimal mark)</li>
<li><code>requested_amount_currency</code></li>
<li>[Secret Key] (provided by your support representative)</li>
</ol>
<p>The SHA-256 hash value is then presented on the merchants client side form as <code>request_signature</code> field.</p>
<p>An example of request signature generation is as follows: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;request_time_stamp          = &#39;20120430123012&#39;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;request_id                  = &#39;order-12345&#39;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;merchant_account_id         = &#39;b19fb056-d8da-449b-ac85-cfbfd0558914&#39;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;transaction_type            = &#39;purchase&#39;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;requested_amount            = &#39;1.01&#39;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;requested_amount_currency   = &#39;USD&#39;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;secret_key                  = &#39;efabf47b-e43b-4785-873f-1c5bc65b7cd2&#39;</div></div><!-- fragment --><p> Pre SHA-256 string </p><blockquote class="doxtable">
<p>20120430123012order-12345b19fb056-d8da-449b-ac85-cfbfd0558914purchase1.01USDefabf47b-e43b-4785-873f-1c5bc65b7cd2 </p>
</blockquote>
<p>SHA-256 signature </p><blockquote class="doxtable">
<p>4510af4db06fd3a3c9952d5beb56be1e7bfaf73ff7842f691c1c0e7269da5e44 </p>
</blockquote>
<h1><a class="anchor" id="sec_signature_generation"></a>
Signature Generation Code Samples</h1>
<ul>
<li>PHP <div class="fragment"><div class="line">$request_signature = hash(<span class="stringliteral">&#39;sha256&#39;</span>, trim($request_time_stamp . $request_id . $merchant_account_id . $transaction_type . $requested_amount . $request_amount_currency . $secret_key));</div></div><!-- fragment --></li>
<li>C#/ASP.NET <div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">string</span> GetSHA256(<span class="keywordtype">string</span> text) {</div><div class="line">       byte[] hashValue;</div><div class="line">       byte[] message = Encoding.UTF8.GetBytes(text);</div><div class="line">       SHA256Managed hashString = <span class="keyword">new</span> SHA256Managed();</div><div class="line">       <span class="keywordtype">string</span> hex = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"></div><div class="line">       hashValue = hashString.ComputeHash(message);</div><div class="line">       <span class="keywordflow">foreach</span>( byte x <span class="keywordflow">in</span> hashValue) {</div><div class="line">             hex += String.Format(<span class="stringliteral">&quot;{0:x2}&quot;</span>, x);</div><div class="line">       }</div><div class="line">       <span class="keywordflow">return</span> hex.Trim();</div><div class="line">}</div></div><!-- fragment --></li>
<li>JAVA <div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> String tosha256(String... fields) {</div><div class="line">    StringBuffer sb = null;</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        MessageDigest md = MessageDigest.getInstance(<span class="stringliteral">&quot;SHA-256&quot;</span>);</div><div class="line">        sb = <span class="keyword">new</span> StringBuffer();</div><div class="line">        <span class="keywordflow">for</span> (String field : fields) {</div><div class="line">            sb.append(field.trim());</div><div class="line">        }</div><div class="line">        md.update(sb.toString().getBytes(<span class="stringliteral">&quot;utf-8&quot;</span>));</div><div class="line">        byte[] mdbytes = md.digest();</div><div class="line">        <span class="keywordflow">return</span> DatatypeConverter.printHexBinary(mdbytes);</div><div class="line">    } <span class="keywordflow">catch</span> (NoSuchAlgorithmException e) {</div><div class="line">        sb = null;</div><div class="line">    } <span class="keywordflow">catch</span> (UnsupportedEncodingException e) {</div><div class="line">        sb = null;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> sb == null ? null : sb.toString();</div><div class="line">}</div></div><!-- fragment --></li>
<li>GROOVY <div class="fragment"><div class="line"><span class="keyword">import</span> java.security.MessageDigest;</div><div class="line">...</div><div class="line"></div><div class="line">def messageDigest = MessageDigest.getInstance(<span class="stringliteral">&quot;SHA256&quot;</span>);</div><div class="line">def secret_key = <span class="stringliteral">&#39;XXXXXXXXXXXXXXXXXXXXXX&#39;</span>;</div><div class="line"></div><div class="line">def stringToHash = time_stamp + request_id + merchant_account_id + transaction_type + requested_amount + requested_amount_currency + secret_key;</div><div class="line"></div><div class="line">messageDigest.update( stringToHash.trim().getBytes() );</div><div class="line">def shaHex = <span class="keyword">new</span> BigInteger(1, messageDigest.digest()).toString(16);</div></div><!-- fragment --> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Mobile SDKs</a></li><li class="navelem"><a class="el" href="p_2_integration.html">Integration</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
